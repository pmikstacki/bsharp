---
import { Icon } from 'astro-icon/components';
---
<section id="install" class="section hue-amber" data-mc-seed="#00ABED">
  <div class="mx-auto w-full max-w-7xl px-4 py-24 md:px-8">
  <div class="glass-mc enable-trig trig-fade-up mx-auto max-w-5xl p-8 md:p-10">
    <div class="prose prose-slate dark:prose-invert">
      <h2>Install</h2>
      <p>Install the CLI with Cargo:</p>
    </div>

    <div class="mt-3 flex items-stretch justify-between gap-3 rounded-xl border p-3 font-mono text-sm shadow-inner" style="background-color:var(--mc-surface-variant);border-color:var(--mc-outline-variant);color:var(--mc-on-surface)">
      <div class="min-w-0 flex-1 overflow-x-auto whitespace-nowrap">cargo install bsharp_cli</div>
      <button type="button" class="btn btn-mc-outline btn-sm shrink-0" data-clipboard="cargo install bsharp_cli">
        <Icon name="lucide:clipboard-copy" class="mr-1 h-4 w-4" /> Copy
      </button>
    </div>

    <div class="prose prose-slate dark:prose-invert mt-6 enable-trig trig-fade-up">
      <p>If not available on crates.io, install from Git:</p>
    </div>

    <div class="mt-3 flex items-stretch justify-between gap-3 rounded-xl border p-3 font-mono text-sm shadow-inner" style="background-color:var(--mc-surface-variant);border-color:var(--mc-outline-variant);color:var(--mc-on-surface)">
      <div class="min-w-0 flex-1 overflow-x-auto whitespace-nowrap">cargo install --git https://github.com/pmikstacki/bsharp --package bsharp_cli</div>
      <button type="button" class="btn btn-mc-outline btn-sm shrink-0" data-clipboard="cargo install --git https://github.com/pmikstacki/bsharp --package bsharp_cli">
        <Icon name="lucide:clipboard-copy" class="mr-1 h-4 w-4" /> Copy
      </button>
    </div>

    <div class="mt-6 enable-trig trig-fade-up">
      <a class="inline-flex items-center gap-2 underline underline-offset-4 hover:opacity-90" style="color:var(--mc-primary)" href="https://github.com/pmikstacki/bsharp/releases" target="_blank" rel="noopener">
        <Icon name="lucide:external-link" class="h-4 w-4" /> View Releases
      </a>
    </div>
  </div>
  </div>
</section>

<script is:inline>
  function copyText(txt, btn){
    const write = async () => {
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(txt);
        } else {
          const ta = document.createElement('textarea');
          ta.value = txt;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
        }
        const original = btn.innerHTML;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>Copied';
        btn.classList.remove('btn-mc-outline');
        btn.classList.add('btn-mc-primary');
        setTimeout(() => { btn.innerHTML = original; btn.classList.remove('btn-mc-primary'); btn.classList.add('btn-mc-outline'); }, 1200);
      } catch {}
    };
    write();
  }
  document.querySelectorAll('button[data-clipboard]').forEach((btn)=>{
    btn.addEventListener('click', ()=> copyText(btn.getAttribute('data-clipboard')||'', btn));
  });
</script>
